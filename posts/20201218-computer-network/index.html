<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


<meta name="robots" content="index, follow">
<title>计算机网络基础（2） | </title>
<meta name="keywords" content="计算机网络" />
<meta name="description" content="计算机网络基础 第一讲主要介绍了计算机网络的体系结构、性能、安全以及挑战和机遇。并且还讲了中科院在网络方面的相关工作。 互联网不仅仅改变生活与社">
<meta name="author" content="">
<link rel="canonical" href="http://landodo.github.io/posts/20201218-computer-network/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css" integrity="sha256-yIlj/i15RiAA/Q&#43;xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as="style">
<link rel="preload" href="./logo.png" as="image">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js" integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://landodo.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://landodo.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://landodo.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://landodo.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="http://landodo.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="计算机网络基础（2）" />
<meta property="og:description" content="计算机网络基础 第一讲主要介绍了计算机网络的体系结构、性能、安全以及挑战和机遇。并且还讲了中科院在网络方面的相关工作。 互联网不仅仅改变生活与社" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://landodo.github.io/posts/20201218-computer-network/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-18T10:17:29&#43;08:00" />
<meta property="article:modified_time" content="2020-12-18T10:17:29&#43;08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="计算机网络基础（2）"/>
<meta name="twitter:description" content="计算机网络基础 第一讲主要介绍了计算机网络的体系结构、性能、安全以及挑战和机遇。并且还讲了中科院在网络方面的相关工作。 互联网不仅仅改变生活与社"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://landodo.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "计算机网络基础（2）",
      "item": "http://landodo.github.io/posts/20201218-computer-network/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "计算机网络基础（2）",
  "name": "计算机网络基础（2）",
  "description": "计算机网络基础 第一讲主要介绍了计算机网络的体系结构、性能、安全以及挑战和机遇。并且还讲了中科院在网络方面的相关工作。 互联网不仅仅改变生活与社",
  "keywords": [
    "计算机网络"
  ],
  "articleBody": "计算机网络基础 第一讲主要介绍了计算机网络的体系结构、性能、安全以及挑战和机遇。并且还讲了中科院在网络方面的相关工作。\n互联网不仅仅改变生活与社会，还推动信息技术本身发展。\n物理传输：通信\n 基础对象：bit 调制、编码、信道、同步 香农定理：$C=Blog_2(1 + \\frac{S}{N})$，C：传输速率；B：信道带宽；S/N 为信噪比。 调幅、调频、调相  数据传输：包交换\n 基础对象：数据帧 存储转发  包交换 VS 链路交换。\n数据传输：介质访问控制 MAC（medium access control）\n网络互连：异构网络，不同物理寻址机制。\n路由与路由查找：路由协议（控制平面）、路由查找转发（数据平面）\n可靠性与传输控制：如何在不可靠路径上尽力而为的实现可靠数据传输？无差错、不丢失、不重复、顺序。如何实现拥塞控制？接收窗口（接收端流控）；拥塞窗口（发送端流控）、拥塞判断：丢包、延迟、多指标。\nDNS：递归查询\n层次结构与实现模块化\n功能放置 // 客户端 SocketFD = socket(PF_INET, SOCK_STREAM, IPPROTO_TCP); connect(SocketFD, (struct sockaddr *)\u0026sa, sizeof sa); send() and recv() write() and read() close();  // 服务器 listen(SocketFD, QUEUE); ConnectFD = accept(SocketFD, NULL, NULL); send() and recv() write() and read(); close(); 报文封装：HTTP Header、TCP Header、IP Header、Ethernet Header。\n延迟构成：$T=T_{tras}+T_{proc}+T_{prop}+T_{queue}$\n $T_{tras}=2P/R$：传输延迟 $T_{proc}$：查找处理 $T_{prop}$：信号传播延迟 $T_{queue}$：排队延迟  吞吐量\nBGP 1989，3 张餐巾纸中的边界网关协议（BGP）图片来源: YAKOV REKHTER/WASHINGTON POST。\n网络的安全性和可靠性：路由安全、DDoS、安全防护困难。\n中科院与中国互联网发展  1975 年，计算所开始关注网络研究 1981 年，计算所成立了网络研究室(十室)是国内最早开始从 事互联网研究的实验室 1983 年，中科院与德国弗朗霍夫信息与生物技术研究所合作 研制了 X.25 分组交换网络，十室承担了该项目  国内最早开始与国外合作从事的网络研究项目 开发了 ISO X.25 底层软件，网络通信和管理软件   1989: NCFC 1992 年 6 月开始，由十室研究中国域名体系 1995 年 3 月，成立计算机网络信息中心  谢老师给学生的一些学习建议：\n 忘记分数\n独立思维 We reject kings, presidents and voting. We believe in: rough consensus and running code. –– David D. Clark\n动手实践 Talk is cheap. Show me the code. –– Linus Torvalds\n 第二讲 网络基础：网络模型与直连网络 武老师是计算所的副研究员，研究方向是互联网体系结构和互联网测量与优化。\n第二讲的主要内容是计算机网络体系结构模型和直连网络（Direct Link Networks）。\n分层网络模型（Layered Network Model）：模块化方案、两层结构、三层结构、分层模型。\n细腰结构（narrow-waist）是互联网体系结构模型中最典型的特征。研究表明，分层的体系结构最终会演化成细腰模型，互联网体系结构一直在演进中，现有结构可能会演化成新的细腰模型。\n直连网络性能指标：带宽（Bandwidth）和时延（Latency）= 传播时延+处理时延+排队时延。\n数据帧封装：添加首部和尾部界定帧的范围。\n引入转义字符进行透明传输。\n差错检测：奇偶检验、检验和 checksum、循环冗余校验（Cyclic Redundancy Check, CRC）。CRC 的本质是 Hash 函数。\n可靠传输基本思想：确认（acknowledgment, ACK）ACK 帧、超时（timeout）重传。\n停等（Stop-and-Wait）协议：最简单的可靠传输协议。\n提升传输速率：序列号（Seq）\n滑动窗口 滑动窗口算法（Sliding-window） ：可靠传输、高效传输、按序到达、流控功能。\n 接收端：对于每个新到达的数据帧 Seq：如果 LastFrame 发送端：收到新的 ACK，更新 LastACK，如果窗口允许，发送新的数据帧，更新 LastFrame。  回退 N 机制（Go-Back-N）恢复丢包。只需要保证 MaxSeq/2 = Wnd，就可以准确区分已接收和等待确认的数据帧。\n多路复用 多路复用技术：频分复用（Frequency Division Multiplexing, FDM）、时分复用（Time Division Multiplexing, TDM）、统计时分复用（Statistic TDM, STDM）、码分复用（Code Division Multiplexing, CDM）。\n载波帧听多路访问（Carrier Sense Multiple Access, CSMA）\n带碰撞检测（Collision Detection）的 CSMA (CSMA/CD)，用于 Ethernet。\n带碰撞避免（Collision Avoidance）的 CSMA (CSMA/CA)，用于 无线局域网络，例如 WiFi。\n以太网 以太网：MAC 地址，以太网基本上统治了有线局域网。\nWiFi 接入 WiFi 热点：\n 扫描：Probe 和 Probe Response 帧 关联：Association Request 和 Association Response 帧 IP 地址分配：DHCP 认证  蜂窝通信 1G 蜂窝通信是为语音通信设计的模拟 FDM 系统，几乎不支持数据传输。\n蜂窝通信网络是覆盖范围最广的通信机制之一。\n5G 毫米波技术、信道编码技术、大规模 MIMO、海量连接、低延迟技术、网络切片。\n第三讲 网络互连 第二讲到第六讲，都由中国科学院计算技术研究所网络技术研究中心的武老师进行讲授。\n第三讲主要讲交换网络、网络互连和数据包队列。\n交换网络的设计目标是数据只朝着目的节点方向传送（转发，Forward）。\n数据帧转发：给定一个包含源目的 MAC 地址的数据帧，如何确定从哪个端口转出?\n 交换机存储目的 MAC 地址到（出）端口的映射关系（Forwarding Database, FDB）。 对于每个数据帧，在 FDB 中查找目的 MAC 地址对应的端口号进行单播或广播。 老化机制（Aging）更新 FDB。 每收一个新的数据帧，记录其源 MAC 地址和入端口，将该映射关系写入 FDB 表。  生成树（Spanning Tree）消除广播风暴。\nIPv4\n无类别域间路由（Classless Inter-Domain Routing, CIDR）：前缀（prefix）长度、网络掩码（network mask）。CIDR 可更加充分的使用 IP 地址。\nIP 数据包头部格式：\n Length：IP 数据包长度，最大为 65535 字节 Protocol：标识所承载协议类型，例如 TCP: 6, UDP: 17 Source \u0026 Destination Address：源目的 IP 地址  IP 报文转发：路由器讲转发信息存储在转发表中（Forwarding Information Base），网络号和下一跳。\n地址解析协议（Address Resolution Protocol, ARP）：知道下一跳 IP 地址，查询其 MAC 地址。ARP 只作用于局域网。\nIP 分片（Fragmentation）：最大传输单元（Maximum Transmission Unit, MTU）。\n互联网控制消息协议（Internet Control Message Protocol, ICMP）：通过发送错误代码、控制信息等来诊断和控制网络。\nNAT（Network Address Translation）\nIPv6：128 位。\n以太网地址转换为 IPv6 地址：\nIPv4 地址到 IPv6 地址的映射\n1. TCP/IP 网络面临的问题及其本质原因？ 从根源分析可以简单分为 3 类问题：\n（1）流量激增问题\n 互联网流量爆炸  流量增长速度远远高于芯片处理性能增长速度 增加带宽并不能从根本上解决问题   本质原因  业务的繁荣 数据的重复传输    IP 流量在 5 年（2012-2017）时间里增长了 4 倍，预计未来 5 年增长 3 倍。\n访问频率重尾特效：少量内容被多次重复访问。\n端到端特性：路由器只负责转发，并不知道重复传输。\nCDN 并不能重根本上解决问题。\n（2）移动性支持问题\n ：断开连接，重新建立连接。\n 端到端连接绑定了地址，移动过程切换地址：断开连接，应用层重新建立连接，服务质量下降 本质原因：  IP 地址的二义性：既想表示位置，又想表明身份。 不支持地址和身份的动态绑定。    （3）可管可控问题\n 安全问题  网络攻击和信息安全事件频发 IP 网络以传输为功能，能保证传输通道安全，不能保障数据的安全 IP 设计之初场景是安全的   管理和控制问题  人工网络配置复杂 缺乏一个独立的配置平台    2. TCP/IP 网络如何支持节点的移动？ IP 地址的两个职责：\n 标识符（Identifier） 定位符（Locator）  2.1 Mobile IP 的技术思路：   假设移动主机有一个永久的 IP 地址\n  称为本地地址 (home address)，作为 identifier\n  与移动前的网络拥有相同前缀\n    主机移动到新的网络时\n 获得新的 IP 地址，作为 locator 两个地址可以共存    locator 负责接收数据，identifier 负责解复用数据。即移动前 locator 和 identifier 地址相同，移动后一收一发。\n2.2 Mobile IP 技术方案  移动主机（Mobile Node）：分配一个永久的本地 IP 地址。 本地代理（Home Agent）：位于移动主机的本地网络，维护本地地址到转交地址的映射。 外地代理（Foreign Agent）：在本地代理与移动主机之间转发数据，周期性向外通告提供转交地址。 转交地址（Care-of-Address）：表示移动主机的位置，通常是外地代理的地址 对端主机（Correspondent Node）  数据发生到移动主机过程：\n（1）本地代理截取目标为移动主机的数据\n（2）本地代理将数据发送到外地代理\n（3）外地代理将数据传送到移动主机\n移动主机注册过程：\n2.3 节点移动  NDN：带状态、hop-by-hop 数据传输 MobileFirst：面向移动的体系结构。关键是 GUID（全局唯一 ID） 到 NA（网络地址）的映射。 FOFIA：服务标识（SID）和网络标识（NID）。 XIA：支持多种结构并存。  3. 未来互联网体系结构试图改变思路是什么? 核心：naming, addressing\n 解决主机和位置关联 解决三个关联问题  4. 新旧互联网过渡的方法有哪些? 过渡机制\n 问题分解 SOFIA 穿越到 IP IP 网络通过 SOFIA 网络连接  5. 网络内缓存存在的双体问题指什么? In-Network cacheing\n网络内：路由、交换设备具有缓存内容的功能\n网络外：CDN 服务器\n核心区别：网络内缓存的双体问题（转发和缓存相互影响）\n6. 比较 IPv4、IPv6、NDN、SOFIA、XIA 3.1 NDN  带状态网络，使得实现和维护复杂 路由表规模庞大，查找困难 交互式应用支持  3.2 MobileFirst  复杂！ 全局映射（CUID 到网络地址 NA）是瓶颈 网络不保存连接状态 使用 NA 加快数据转发  3.3 SOFIA   结合了 NDN/MobilityFirst 和 IP 的特性。\n  支持不同种类的应用（如实时通信）\n  网络仍是无状态的\n  路由表面临与 NDN同样的拓展性问题\n  3.4 XIA: Expressive Internet Architecture  支持多种体系结构的体系结构 包头需要压缩 支持体系的演进  7. 安全问题如何通过未来互联网解决？  AIP：Accountability IP，问责制，网络和主机使用自验证（self-certifying）地址，公钥。 网络上的任何一个数据包最终都能追溯到主机（个人）。  ",
  "wordCount" : "4047",
  "inLanguage": "en",
  "datePublished": "2020-12-18T10:17:29+08:00",
  "dateModified": "2020-12-18T10:17:29+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://landodo.github.io/posts/20201218-computer-network/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "",
    "logo": {
      "@type": "ImageObject",
      "url": "http://landodo.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="http://landodo.github.io/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://landodo.github.io/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://landodo.github.io/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="http://landodo.github.io/tags" title="Tag">
                    <span>Tag</span>
                </a>
            </li>
            <li>
                <a href="http://landodo.github.io/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://landodo.github.io/cs-zoo" title="CS ZOO">
                    <span>CS ZOO</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://landodo.github.io/">Home</a>&nbsp;»&nbsp;<a href="http://landodo.github.io/posts/">Posts</a></div>
    <h1 class="post-title">
      计算机网络基础（2）
    </h1>
    <div class="post-meta"><span title='2020-12-18 10:17:29 +0800 CST'>December 18, 2020</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;4047 words

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c%e5%9f%ba%e7%a1%80" aria-label="计算机网络基础">计算机网络基础</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e5%8a%9f%e8%83%bd%e6%94%be%e7%bd%ae" aria-label="功能放置">功能放置</a></li>
                <li>
                    <a href="#bgp" aria-label="BGP">BGP</a></li>
                <li>
                    <a href="#%e4%b8%ad%e7%a7%91%e9%99%a2%e4%b8%8e%e4%b8%ad%e5%9b%bd%e4%ba%92%e8%81%94%e7%bd%91%e5%8f%91%e5%b1%95" aria-label="中科院与中国互联网发展">中科院与中国互联网发展</a></li></ul>
                    
                <li>
                    <a href="#%e7%ac%ac%e4%ba%8c%e8%ae%b2-%e7%bd%91%e7%bb%9c%e5%9f%ba%e7%a1%80%e7%bd%91%e7%bb%9c%e6%a8%a1%e5%9e%8b%e4%b8%8e%e7%9b%b4%e8%bf%9e%e7%bd%91%e7%bb%9c" aria-label="第二讲 网络基础：网络模型与直连网络">第二讲 网络基础：网络模型与直连网络</a><ul>
                        
                <li>
                    <a href="#%e6%bb%91%e5%8a%a8%e7%aa%97%e5%8f%a3" aria-label="滑动窗口">滑动窗口</a></li>
                <li>
                    <a href="#%e5%a4%9a%e8%b7%af%e5%a4%8d%e7%94%a8" aria-label="多路复用">多路复用</a></li>
                <li>
                    <a href="#%e4%bb%a5%e5%a4%aa%e7%bd%91" aria-label="以太网">以太网</a></li></ul>
                </li>
                <li>
                    <a href="#wifi" aria-label="WiFi">WiFi</a><ul>
                        
                <li>
                    <a href="#%e8%9c%82%e7%aa%9d%e9%80%9a%e4%bf%a1" aria-label="蜂窝通信">蜂窝通信</a></li>
                <li>
                    <a href="#5g" aria-label="5G">5G</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%ac%ac%e4%b8%89%e8%ae%b2-%e7%bd%91%e7%bb%9c%e4%ba%92%e8%bf%9e" aria-label="第三讲 网络互连">第三讲 网络互连</a></li>
                <li>
                    <a href="#1-tcpip-%e7%bd%91%e7%bb%9c%e9%9d%a2%e4%b8%b4%e7%9a%84%e9%97%ae%e9%a2%98%e5%8f%8a%e5%85%b6%e6%9c%ac%e8%b4%a8%e5%8e%9f%e5%9b%a0" aria-label="1. TCP/IP 网络面临的问题及其本质原因？">1. TCP/IP 网络面临的问题及其本质原因？</a></li>
                <li>
                    <a href="#2-tcpip-%e7%bd%91%e7%bb%9c%e5%a6%82%e4%bd%95%e6%94%af%e6%8c%81%e8%8a%82%e7%82%b9%e7%9a%84%e7%a7%bb%e5%8a%a8" aria-label="2. TCP/IP 网络如何支持节点的移动？">2. TCP/IP 网络如何支持节点的移动？</a><ul>
                        
                <li>
                    <a href="#21-mobile-ip-%e7%9a%84%e6%8a%80%e6%9c%af%e6%80%9d%e8%b7%af" aria-label="2.1 Mobile IP 的技术思路：">2.1 Mobile IP 的技术思路：</a></li>
                <li>
                    <a href="#22-mobile-ip-%e6%8a%80%e6%9c%af%e6%96%b9%e6%a1%88" aria-label="2.2 Mobile IP 技术方案">2.2 Mobile IP 技术方案</a></li>
                <li>
                    <a href="#23-%e8%8a%82%e7%82%b9%e7%a7%bb%e5%8a%a8" aria-label="2.3 节点移动">2.3 节点移动</a></li></ul>
                </li>
                <li>
                    <a href="#3--%e6%9c%aa%e6%9d%a5%e4%ba%92%e8%81%94%e7%bd%91%e4%bd%93%e7%b3%bb%e7%bb%93%e6%9e%84%e8%af%95%e5%9b%be%e6%94%b9%e5%8f%98%e6%80%9d%e8%b7%af%e6%98%af%e4%bb%80%e4%b9%88" aria-label="3.  未来互联网体系结构试图改变思路是什么?">3.  未来互联网体系结构试图改变思路是什么?</a></li>
                <li>
                    <a href="#4-%e6%96%b0%e6%97%a7%e4%ba%92%e8%81%94%e7%bd%91%e8%bf%87%e6%b8%a1%e7%9a%84%e6%96%b9%e6%b3%95%e6%9c%89%e5%93%aa%e4%ba%9b" aria-label="4. 新旧互联网过渡的方法有哪些?">4. 新旧互联网过渡的方法有哪些?</a></li>
                <li>
                    <a href="#5-%e7%bd%91%e7%bb%9c%e5%86%85%e7%bc%93%e5%ad%98%e5%ad%98%e5%9c%a8%e7%9a%84%e5%8f%8c%e4%bd%93%e9%97%ae%e9%a2%98%e6%8c%87%e4%bb%80%e4%b9%88" aria-label="5. 网络内缓存存在的双体问题指什么?">5. 网络内缓存存在的双体问题指什么?</a></li>
                <li>
                    <a href="#6-%e6%af%94%e8%be%83-ipv4ipv6ndnsofiaxia" aria-label="6. 比较 IPv4、IPv6、NDN、SOFIA、XIA">6. 比较 IPv4、IPv6、NDN、SOFIA、XIA</a><ul>
                        
                <li>
                    <a href="#31-ndn" aria-label="3.1 NDN">3.1 NDN</a></li>
                <li>
                    <a href="#32-mobilefirst" aria-label="3.2 MobileFirst">3.2 MobileFirst</a></li>
                <li>
                    <a href="#33-sofia" aria-label="3.3 SOFIA">3.3 SOFIA</a></li>
                <li>
                    <a href="#34-xia-expressive-internet-architecture" aria-label="3.4 XIA: Expressive Internet Architecture">3.4 XIA: Expressive Internet Architecture</a></li></ul>
                </li>
                <li>
                    <a href="#7-%e5%ae%89%e5%85%a8%e9%97%ae%e9%a2%98%e5%a6%82%e4%bd%95%e9%80%9a%e8%bf%87%e6%9c%aa%e6%9d%a5%e4%ba%92%e8%81%94%e7%bd%91%e8%a7%a3%e5%86%b3" aria-label="7. 安全问题如何通过未来互联网解决？">7. 安全问题如何通过未来互联网解决？</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="计算机网络基础">计算机网络基础<a hidden class="anchor" aria-hidden="true" href="#计算机网络基础">#</a></h1>
<p>第一讲主要介绍了计算机网络的体系结构、性能、安全以及挑战和机遇。并且还讲了中科院在网络方面的相关工作。</p>
<p>互联网不仅仅改变生活与社会，还推动信息技术本身发展。</p>
<p>物理传输：通信</p>
<ul>
<li>基础对象：bit</li>
<li>调制、编码、信道、同步</li>
<li>香农定理：$C=Blog_2(1 + \frac{S}{N})$，C：传输速率；B：信道带宽；S/N 为信噪比。</li>
<li>调幅、调频、调相</li>
</ul>
<p>数据传输：包交换</p>
<ul>
<li>基础对象：数据帧</li>
<li>存储转发</li>
</ul>
<p>包交换 VS 链路交换。</p>
<p>数据传输：介质访问控制 MAC（medium access control）</p>
<p>网络互连：异构网络，不同物理寻址机制。</p>
<p>路由与路由查找：路由协议（控制平面）、路由查找转发（数据平面）</p>
<p>可靠性与传输控制：如何在不可靠路径上尽力而为的实现可靠数据传输？无差错、不丢失、不重复、顺序。如何实现拥塞控制？接收窗口（接收端流控）；拥塞窗口（发送端流控）、拥塞判断：丢包、延迟、多指标。</p>
<p>DNS：递归查询</p>
<p>层次结构与实现模块化</p>
<p><img loading="lazy" src="./20201218/2.jpeg" alt=""  />
</p>
<h3 id="功能放置">功能放置<a hidden class="anchor" aria-hidden="true" href="#功能放置">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">// 客户端
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>SocketFD <span style="color:#f92672">=</span> socket(PF_INET, SOCK_STREAM, IPPROTO_TCP);
</span></span><span style="display:flex;"><span>connect(SocketFD, (<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">sockaddr</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>sa, <span style="color:#66d9ef">sizeof</span> sa);
</span></span><span style="display:flex;"><span>send() and recv()
</span></span><span style="display:flex;"><span>write() and read()
</span></span><span style="display:flex;"><span>close();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 服务器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>listen(SocketFD, QUEUE);
</span></span><span style="display:flex;"><span>ConnectFD <span style="color:#f92672">=</span> accept(SocketFD, NULL, NULL);
</span></span><span style="display:flex;"><span>send() and recv()
</span></span><span style="display:flex;"><span>write() and read();
</span></span><span style="display:flex;"><span>close();
</span></span></code></pre></div><p>报文封装：HTTP Header、TCP Header、IP Header、Ethernet Header。</p>
<p>延迟构成：$T=T_{tras}+T_{proc}+T_{prop}+T_{queue}$</p>
<ul>
<li>$T_{tras}=2P/R$：传输延迟</li>
<li>$T_{proc}$：查找处理</li>
<li>$T_{prop}$：信号传播延迟</li>
<li>$T_{queue}$：排队延迟</li>
</ul>
<p>吞吐量</p>
<p><img loading="lazy" src="./20201218/3.jpeg" alt=""  />
</p>
<h3 id="bgp">BGP<a hidden class="anchor" aria-hidden="true" href="#bgp">#</a></h3>
<p>1989，3 张餐巾纸中的边界网关协议（BGP）<a href="https://www.stuff.co.nz/technology/digital-living/69048160/the-three-napkins-protocol-quick-fix-for-early-internet-problem-left-web-open-to-attack">图片来源: YAKOV REKHTER/WASHINGTON POST</a>。</p>
<p><img loading="lazy" src="./20201218/4.jpg" alt=""  />
</p>
<p>网络的安全性和可靠性：路由安全、DDoS、安全防护困难。</p>
<h3 id="中科院与中国互联网发展">中科院与中国互联网发展<a hidden class="anchor" aria-hidden="true" href="#中科院与中国互联网发展">#</a></h3>
<ul>
<li>1975 年，计算所开始关注网络研究</li>
<li>1981 年，计算所成立了网络研究室(十室)是国内最早开始从
事互联网研究的实验室</li>
<li>1983 年，中科院与德国弗朗霍夫信息与生物技术研究所合作 研制了 X.25 分组交换网络，十室承担了该项目
<ul>
<li>国内最早开始与国外合作从事的网络研究项目</li>
<li>开发了 ISO X.25 底层软件，网络通信和管理软件</li>
</ul>
</li>
<li>1989: NCFC</li>
<li>1992 年 6 月开始，由十室研究中国域名体系</li>
<li>1995 年 3 月，成立计算机网络信息中心</li>
</ul>
<p><img loading="lazy" src="./20201218/1.jpeg" alt=""  />
</p>
<p>谢老师给学生的一些学习建议：</p>
<blockquote>
<p>忘记分数</p>
<p>独立思维
We reject kings, presidents and voting. We believe in: rough consensus and running code.
–– David D. Clark</p>
<p>动手实践
Talk is cheap. Show me the code.
–– Linus Torvalds</p>
</blockquote>
<h2 id="第二讲-网络基础网络模型与直连网络">第二讲 网络基础：网络模型与直连网络<a hidden class="anchor" aria-hidden="true" href="#第二讲-网络基础网络模型与直连网络">#</a></h2>
<p>武老师是计算所的副研究员，研究方向是互联网体系结构和互联网测量与优化。</p>
<p>第二讲的主要内容是计算机网络体系结构模型和直连网络（Direct Link Networks）。</p>
<p>分层网络模型（Layered Network Model）：模块化方案、两层结构、三层结构、分层模型。</p>
<p><img loading="lazy" src="./20201218/5.png" alt=""  />
</p>
<p>细腰结构（narrow-waist）是互联网体系结构模型中最典型的特征。研究表明，分层的体系结构最终会演化成细腰模型，互联网体系结构一直在演进中，现有结构可能会演化成新的细腰模型。</p>
<p>直连网络性能指标：带宽（Bandwidth）和时延（Latency）= 传播时延+处理时延+排队时延。</p>
<p>数据帧封装：添加首部和尾部界定帧的范围。</p>
<p>引入转义字符进行透明传输。</p>
<p>差错检测：奇偶检验、检验和 checksum、循环冗余校验（Cyclic Redundancy Check, CRC）。CRC 的本质是 Hash 函数。</p>
<p>可靠传输基本思想：确认（acknowledgment, ACK）ACK 帧、超时（timeout）重传。</p>
<p>停等（Stop-and-Wait）协议：最简单的可靠传输协议。</p>
<p>提升传输速率：序列号（Seq）</p>
<h3 id="滑动窗口">滑动窗口<a hidden class="anchor" aria-hidden="true" href="#滑动窗口">#</a></h3>
<p><strong>滑动窗口算法（Sliding-window）</strong> ：可靠传输、高效传输、按序到达、流控功能。</p>
<ul>
<li>接收端：对于每个新到达的数据帧 Seq：如果 LastFrame &lt; Seq &lt;= ExpMaxFrame，则接受；否则，丢弃。接受数据帧后，将收到的最大连续数据帧 Seq 作为 ACK 回复。</li>
<li>发送端：收到新的 ACK，更新 LastACK，如果窗口允许，发送新的数据帧，更新 LastFrame。</li>
</ul>
<p>回退 N 机制（Go-Back-N）恢复丢包。只需要保证 MaxSeq/2 &gt;= Wnd，就可以准确区分已接收和等待确认的数据帧。</p>
<p><img loading="lazy" src="./20201218/6.jpeg" alt=""  />
</p>
<h3 id="多路复用">多路复用<a hidden class="anchor" aria-hidden="true" href="#多路复用">#</a></h3>
<p>多路复用技术：频分复用（Frequency Division Multiplexing, FDM）、时分复用（Time Division Multiplexing, TDM）、统计时分复用（Statistic TDM, STDM）、码分复用（Code Division Multiplexing, CDM）。</p>
<p>载波帧听多路访问（Carrier Sense Multiple Access, CSMA）</p>
<p>带碰撞检测（Collision Detection）的 CSMA (CSMA/CD)，用于 Ethernet。</p>
<p>带碰撞避免（Collision Avoidance）的 CSMA (CSMA/CA)，用于 无线局域网络，例如 WiFi。</p>
<h3 id="以太网">以太网<a hidden class="anchor" aria-hidden="true" href="#以太网">#</a></h3>
<p>以太网：MAC 地址，以太网基本上统治了有线局域网。</p>
<h2 id="wifi">WiFi<a hidden class="anchor" aria-hidden="true" href="#wifi">#</a></h2>
<p><img loading="lazy" src="./20201218/7.jpeg" alt=""  />
</p>
<p>接入 WiFi 热点：</p>
<ul>
<li>扫描：Probe 和 Probe Response 帧</li>
<li>关联：Association Request 和 Association Response 帧</li>
<li>IP 地址分配：DHCP</li>
<li>认证</li>
</ul>
<h3 id="蜂窝通信">蜂窝通信<a hidden class="anchor" aria-hidden="true" href="#蜂窝通信">#</a></h3>
<p>1G 蜂窝通信是为语音通信设计的<strong>模拟 FDM 系统</strong>，几乎不支持数据传输。</p>
<p>蜂窝通信网络是覆盖范围最广的通信机制之一。</p>
<h3 id="5g">5G<a hidden class="anchor" aria-hidden="true" href="#5g">#</a></h3>
<p>毫米波技术、信道编码技术、大规模 MIMO、海量连接、低延迟技术、网络切片。</p>
<h2 id="第三讲-网络互连">第三讲 网络互连<a hidden class="anchor" aria-hidden="true" href="#第三讲-网络互连">#</a></h2>
<p>第二讲到第六讲，都由中国科学院计算技术研究所网络技术研究中心的武老师进行讲授。</p>
<p>第三讲主要讲交换网络、网络互连和数据包队列。</p>
<p>交换网络的设计目标是数据只朝着目的节点方向传送（转发，Forward）。</p>
<p>数据帧转发：给定一个包含源目的 MAC 地址的数据帧，如何确定从哪个端口转出?</p>
<ul>
<li>交换机存储目的 MAC 地址到（出）端口的映射关系（Forwarding Database, FDB）。</li>
<li>对于每个数据帧，在 FDB 中查找目的 MAC 地址对应的端口号进行单播或广播。</li>
<li>老化机制（Aging）更新 FDB。</li>
<li>每收一个新的数据帧，记录其源 MAC 地址和入端口，将该映射关系写入 FDB 表。</li>
</ul>
<p>生成树（Spanning Tree）消除广播风暴。</p>
<p>IPv4</p>
<p><img loading="lazy" src="./20201218/8.jpeg" alt=""  />
</p>
<p>无类别域间路由（Classless Inter-Domain Routing, CIDR）：前缀（prefix）长度、网络掩码（network mask）。CIDR 可更加充分的使用 IP 地址。</p>
<p>IP 数据包头部格式：</p>
<ul>
<li>Length：IP 数据包长度，最大为 65535 字节</li>
<li>Protocol：标识所承载协议类型，例如 TCP: 6, UDP: 17</li>
<li>Source &amp; Destination Address：源目的 IP 地址</li>
</ul>
<p><img loading="lazy" src="./20201218/9.jpeg" alt=""  />
</p>
<p>IP 报文转发：路由器讲转发信息存储在转发表中（Forwarding Information Base），网络号和下一跳。</p>
<p>地址解析协议（Address Resolution Protocol, ARP）：知道下一跳 IP 地址，查询其 MAC 地址。ARP 只作用于局域网。</p>
<p>IP 分片（Fragmentation）：最大传输单元（Maximum Transmission Unit, MTU）。</p>
<p>互联网控制消息协议（Internet Control Message Protocol, ICMP）：通过发送错误代码、控制信息等来诊断和控制网络。</p>
<p>NAT（Network Address Translation）</p>
<p>IPv6：128 位。</p>
<p>以太网地址转换为 IPv6 地址：</p>
<p><img loading="lazy" src="./20201218/10.jpeg" alt=""  />
</p>
<p>IPv4 地址到 IPv6 地址的映射</p>
<p><img loading="lazy" src="./20201218/11.jpeg" alt=""  />
</p>
<h2 id="1-tcpip-网络面临的问题及其本质原因">1. TCP/IP 网络面临的问题及其本质原因？<a hidden class="anchor" aria-hidden="true" href="#1-tcpip-网络面临的问题及其本质原因">#</a></h2>
<p>从根源分析可以简单分为 3 类问题：</p>
<p><strong>（1）流量激增问题</strong></p>
<ul>
<li>互联网流量爆炸
<ul>
<li>流量增长速度远远高于芯片处理性能增长速度</li>
<li>增加带宽并不能从根本上解决问题</li>
</ul>
</li>
<li>本质原因
<ul>
<li>业务的繁荣</li>
<li>数据的重复传输</li>
</ul>
</li>
</ul>
<p>IP 流量在 5 年（2012-2017）时间里增长了 4 倍，预计未来 5 年增长 3 倍。</p>
<p>访问频率重尾特效：少量内容被多次重复访问。</p>
<p>端到端特性：路由器只负责转发，并不知道重复传输。</p>
<p>CDN 并不能重根本上解决问题。</p>
<p><strong>（2）移动性支持问题</strong></p>
<p><code>&lt;sIP, dIP, sPort, dPort, protocol&gt;</code> ：断开连接，重新建立连接。</p>
<ul>
<li>端到端连接绑定了地址，移动过程切换地址：断开连接，应用层重新建立连接，服务质量下降</li>
<li>本质原因：
<ul>
<li>IP 地址的二义性：既想表示位置，又想表明身份。</li>
<li>不支持地址和身份的动态绑定。</li>
</ul>
</li>
</ul>
<p><strong>（3）可管可控问题</strong></p>
<ul>
<li>安全问题
<ul>
<li>网络攻击和信息安全事件频发</li>
<li>IP 网络以传输为功能，能保证传输通道安全，不能保障数据的安全</li>
<li>IP 设计之初场景是安全的</li>
</ul>
</li>
<li>管理和控制问题
<ul>
<li>人工网络配置复杂</li>
<li>缺乏一个独立的配置平台</li>
</ul>
</li>
</ul>
<h2 id="2-tcpip-网络如何支持节点的移动">2. TCP/IP 网络如何支持节点的移动？<a hidden class="anchor" aria-hidden="true" href="#2-tcpip-网络如何支持节点的移动">#</a></h2>
<p>IP 地址的两个职责：</p>
<ul>
<li>标识符（Identifier）</li>
<li>定位符（Locator）</li>
</ul>
<h3 id="21-mobile-ip-的技术思路">2.1 Mobile IP 的技术思路：<a hidden class="anchor" aria-hidden="true" href="#21-mobile-ip-的技术思路">#</a></h3>
<ul>
<li>
<p>假设移动主机有一个永久的 IP 地址</p>
<ul>
<li>
<p>称为本地地址 (home address)，作为 identifier</p>
</li>
<li>
<p>与移动前的网络拥有相同前缀</p>
</li>
</ul>
</li>
<li>
<p>主机移动到新的网络时</p>
<ul>
<li>获得新的 IP 地址，作为 locator</li>
<li>两个地址可以共存</li>
</ul>
</li>
</ul>
<p>locator 负责接收数据，identifier 负责解复用数据。即移动前 locator 和 identifier 地址相同，移动后一收一发。</p>
<h3 id="22-mobile-ip-技术方案">2.2 Mobile IP 技术方案<a hidden class="anchor" aria-hidden="true" href="#22-mobile-ip-技术方案">#</a></h3>
<ul>
<li>移动主机（Mobile Node）：分配一个永久的本地 IP 地址。</li>
<li>本地代理（Home Agent）：位于移动主机的本地网络，维护本地地址到转交地址的映射。</li>
<li>外地代理（Foreign Agent）：在本地代理与移动主机之间转发数据，周期性向外通告提供转交地址。</li>
<li>转交地址（Care-of-Address）：表示移动主机的位置，通常是外地代理的地址</li>
<li>对端主机（Correspondent Node）</li>
</ul>
<p>数据发生到移动主机过程：</p>
<p>（1）本地代理截取目标为移动主机的数据</p>
<p>（2）本地代理将数据发送到外地代理</p>
<p>（3）外地代理将数据传送到移动主机</p>
<p><img loading="lazy" src="./20201218/12.jpeg" alt=""  />
</p>
<p>移动主机注册过程：</p>
<p><img loading="lazy" src="./20201218/13.jpeg" alt=""  />
</p>
<h3 id="23-节点移动">2.3 节点移动<a hidden class="anchor" aria-hidden="true" href="#23-节点移动">#</a></h3>
<ul>
<li>NDN：带状态、hop-by-hop 数据传输</li>
<li>MobileFirst：面向移动的体系结构。关键是 GUID（全局唯一 ID） 到 NA（网络地址）的映射。</li>
<li>FOFIA：服务标识（SID）和网络标识（NID）。</li>
<li>XIA：支持多种结构并存。</li>
</ul>
<h2 id="3--未来互联网体系结构试图改变思路是什么">3.  未来互联网体系结构试图改变思路是什么?<a hidden class="anchor" aria-hidden="true" href="#3--未来互联网体系结构试图改变思路是什么">#</a></h2>
<p>核心：naming, addressing</p>
<ul>
<li>解决主机和位置关联</li>
<li>解决三个关联问题</li>
</ul>
<h2 id="4-新旧互联网过渡的方法有哪些">4. 新旧互联网过渡的方法有哪些?<a hidden class="anchor" aria-hidden="true" href="#4-新旧互联网过渡的方法有哪些">#</a></h2>
<p><strong>过渡机制</strong></p>
<ul>
<li>问题分解</li>
<li>SOFIA 穿越到 IP</li>
<li>IP 网络通过 SOFIA 网络连接</li>
</ul>
<p><img loading="lazy" src="./20201218/15.jpeg" alt=""  />
</p>
<h2 id="5-网络内缓存存在的双体问题指什么">5. 网络内缓存存在的双体问题指什么?<a hidden class="anchor" aria-hidden="true" href="#5-网络内缓存存在的双体问题指什么">#</a></h2>
<p>In-Network cacheing</p>
<p>网络内：路由、交换设备具有缓存内容的功能</p>
<p>网络外：CDN 服务器</p>
<p>核心区别：网络内缓存的双体问题（<strong>转发和缓存相互影响</strong>）</p>
<h2 id="6-比较-ipv4ipv6ndnsofiaxia">6. 比较 IPv4、IPv6、NDN、SOFIA、XIA<a hidden class="anchor" aria-hidden="true" href="#6-比较-ipv4ipv6ndnsofiaxia">#</a></h2>
<p><img loading="lazy" src="./20201218/14.jpeg" alt=""  />
</p>
<h3 id="31-ndn">3.1 NDN<a hidden class="anchor" aria-hidden="true" href="#31-ndn">#</a></h3>
<ul>
<li>带状态网络，使得实现和维护复杂</li>
<li>路由表规模庞大，查找困难</li>
<li>交互式应用支持</li>
</ul>
<h3 id="32-mobilefirst">3.2 MobileFirst<a hidden class="anchor" aria-hidden="true" href="#32-mobilefirst">#</a></h3>
<ul>
<li>复杂！</li>
<li>全局映射（CUID 到网络地址 NA）是瓶颈</li>
<li>网络不保存连接状态</li>
<li>使用 NA 加快数据转发</li>
</ul>
<h3 id="33-sofia">3.3 SOFIA<a hidden class="anchor" aria-hidden="true" href="#33-sofia">#</a></h3>
<ul>
<li>
<p>结合了 NDN/MobilityFirst 和 IP 的特性。</p>
</li>
<li>
<p>支持不同种类的应用（如实时通信）</p>
</li>
<li>
<p>网络仍是无状态的</p>
</li>
<li>
<p>路由表面临与 NDN同样的拓展性问题</p>
</li>
</ul>
<h3 id="34-xia-expressive-internet-architecture">3.4 XIA: Expressive Internet Architecture<a hidden class="anchor" aria-hidden="true" href="#34-xia-expressive-internet-architecture">#</a></h3>
<ul>
<li>支持多种体系结构的体系结构</li>
<li>包头需要压缩</li>
<li>支持体系的演进</li>
</ul>
<h2 id="7-安全问题如何通过未来互联网解决">7. 安全问题如何通过未来互联网解决？<a hidden class="anchor" aria-hidden="true" href="#7-安全问题如何通过未来互联网解决">#</a></h2>
<ul>
<li>AIP：Accountability IP，问责制，网络和主机使用自验证（self-certifying）地址，公钥。</li>
<li>网络上的任何一个数据包最终都能追溯到主机（个人）。</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://landodo.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://landodo.github.io/posts/20201225-computer-network-review/">
    <span class="title">« Prev Page</span>
    <br>
    <span>计算机网络基础（3）</span>
  </a>
  <a class="next" href="http://landodo.github.io/posts/20201214-shortest-path/">
    <span class="title">Next Page »</span>
    <br>
    <span>最短路径问题 Shortest Path</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>Landon</span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
